{% extends "quiz/base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block base_css_extra %}
  .wrap{max-width:980px;margin:0 auto;}
  .hero{
    display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;
    margin-bottom:12px;
  }
  .hero h1{margin:0;font-size:18px;font-weight:1000;letter-spacing:.2px}
  .hero p{margin:6px 0 0;line-height:1.9;color:var(--mut)}
  .glass{
    background:rgba(255,255,255,.82);
    border:1px solid rgba(231,238,246,.95);
    border-radius:22px;
    box-shadow: var(--shadow2);
  }
  .card{padding:16px}
  .grid{display:grid;grid-template-columns: 1fr 1fr;gap:12px;margin-top:12px}
  @media (max-width: 820px){.grid{grid-template-columns:1fr}}
  .kv{
    padding:12px;border-radius:16px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.78);
  }
  .k{font-size:12px;font-weight:1000;color:var(--mut);margin-bottom:6px}
  .v{font-size:14px;font-weight:1000;color:var(--ink);line-height:1.7}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 10px;border-radius:999px;
    border:1px solid rgba(2,44,34,.12);
    background:rgba(14,165,233,.08);
    font-weight:1000;font-size:12px;color:var(--ink);
  }
  .warn{
    display:flex;align-items:flex-start;gap:10px;
    padding:12px;border-radius:18px;
    border:1px solid rgba(239,68,68,.25);
    background: rgba(254,226,226,.65);
    color:#7f1d1d;
    font-weight:900;line-height:1.9;
    margin-top:12px;
  }
  .warn .ic{
    width:32px;height:32px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    background:rgba(239,68,68,.18);flex:0 0 auto;
    font-size:16px
  }
  .ok{
    border:1px solid rgba(14,165,233,.22);
    background: rgba(224,242,254,.6);
    color:#0c4a6e;
  }
  .ok .ic{background:rgba(14,165,233,.16)}
  .actions{
    display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:14px
  }
  .btn{
    appearance:none;border:0;cursor:pointer;
    border-radius:14px;padding:10px 14px;
    font-weight:1000;font-size:13px;
    display:inline-flex;align-items:center;gap:8px;
    text-decoration:none;
  }
  .btn-secondary{
    background:rgba(15,23,42,.06);
    border:1px solid rgba(15,23,42,.10);
    color:var(--ink);
  }
  .btn-secondary:hover{background:rgba(15,23,42,.09)}
  .btn-danger{
    background:linear-gradient(135deg,#ef4444,#b91c1c);
    color:#fff;
    box-shadow: 0 14px 26px rgba(239,68,68,.22);
  }
  .btn-danger:hover{filter:brightness(.98)}
  .btn-primary{
    background:linear-gradient(135deg,#0ea5e9,#22c55e);
    color:#fff;
    box-shadow: 0 14px 26px rgba(14,165,233,.18);
  }
  .btn-primary:hover{filter:brightness(.98)}
  .tiny{font-size:12px;color:var(--mut);margin-top:8px;line-height:1.7}
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="hero">
    <div>
      <h1>{{ title }}</h1>
      <p>{{ subtitle }}</p>
    </div>
    <div class="pill">
      <span>Ù…Ø­Ø§ÙˆÙ„Ø© #{{ attempt.id }}</span>
      {% if attempt.is_finished %}
        <span style="opacity:.8">â€¢ Ù…Ù†ØªÙ‡ÙŠØ©</span>
      {% else %}
        <span style="opacity:.8">â€¢ Ø¬Ø§Ø±ÙŠØ©</span>
      {% endif %}
    </div>
  </div>

  <div class="glass card">
    <div class="grid">
      <div class="kv">
        <div class="k">Ø§Ù„Ù…Ø±Ø´Ø­</div>
        <div class="v">{{ p.full_name }} <span style="opacity:.55">({{ p.national_id }})</span></div>
      </div>
      <div class="kv">
        <div class="k">Ø§Ù„Ù…Ø¬Ø§Ù„ / Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
        <div class="v">{{ p.get_domain_display }} â€” {{ quiz.title }}</div>
      </div>
      <div class="kv">
        <div class="k">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡</div>
        <div class="v">{{ attempt.started_at|date:"Y-m-d H:i" }}</div>
      </div>
      <div class="kv">
        <div class="k">Ø§Ù„Ø­Ø§Ù„Ø©</div>
        <div class="v">
          {% if attempt.is_finished %}
            Ù…Ù†ØªÙ‡ÙŠØ©
            {% if attempt.finished_reason %}
              <span style="opacity:.7">({{ attempt.get_finished_reason_display }})</span>
            {% endif %}
          {% else %}
            Ø¬Ø§Ø±ÙŠØ©
          {% endif %}
        </div>
      </div>
    </div>

    <div class="{% if danger %}warn{% else %}warn ok{% endif %}">
      <div class="ic">{% if danger %}âš ï¸{% else %}âœ…{% endif %}</div>
      <div>
        <div style="font-weight:1000;margin-bottom:4px">
          {% if danger %}
            Ø§Ù†ØªØ¨Ù‡: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø­Ø³Ø§Ø³
          {% else %}
            ØªØ£ÙƒÙŠØ¯ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
          {% endif %}
        </div>
        <div>
          {% if danger %}
            Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±Ù‹Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯. ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø§Ø®ØªØ±Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©.
          {% else %}
            Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª.
          {% endif %}
        </div>
      </div>
    </div>

    <form method="post" action="{% url action_url_name attempt.id %}" style="margin-top:14px">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next }}">
      <div class="actions">
        <a class="btn btn-secondary" href="{% if next %}{{ next }}{% else %}{% url 'quiz:staff_manage' %}{% endif %}">
          â†© Ø±Ø¬ÙˆØ¹
        </a>

        {% if danger %}
          <button class="btn btn-danger" type="submit">
            ğŸ”’ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
          </button>
        {% else %}
          <button class="btn btn-primary" type="submit">
            â™»ï¸ ØªØ£ÙƒÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØªØ­
          </button>
        {% endif %}
      </div>

      <div class="tiny">
        ØªÙ„Ù…ÙŠØ­: Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ù„Ùƒ Ù…Ø´ÙƒÙ„Ø© CSRF Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¬Ø¯ÙŠØ¯ØŒ Ø­Ø¯Ù‘Ø« Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.
      </div>
    </form>
  </div>
</div>
{% endblock %}
