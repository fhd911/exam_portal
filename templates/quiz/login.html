{% extends "quiz/base.html" %}
{% block title %}تسجيل الدخول للاختبار{% endblock %}

{% block frame_open %}{% endblock %}
{% block frame_close %}{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="auth-card">
    <div class="auth-head">
      <div class="auth-hero">
        <div class="auth-ico">✓</div>
        <div class="auth-hero-text">
          <h1 class="auth-title">تسجيل الدخول للاختبار</h1>
          <p class="auth-sub">
            أدخل <b>السجل المدني</b> و <b>آخر 4 أرقام من الجوال</b> للتحقق.
          </p>
        </div>

        {# ✅ أزرار صغيرة (بدون كلمة موظف) #}
        <div class="auth-actions">
          {% if request.user.is_authenticated and request.user.is_staff %}
            <a class="btn-mini danger" href="{% url 'quiz:staff_logout' %}">خروج الإدارة</a>
          {% endif %}
          <a class="btn-mini ghost" href="{% url 'quiz:home' %}">الرئيسية</a>
          {# اختياري: تفريغ جلسة المتقدم لو تبغاه #}
          <a class="btn-mini" href="{% url 'quiz:logout' %}">إعادة ضبط</a>
        </div>
      </div>
    </div>

    <div class="auth-body">
      <form method="post" action="" class="auth-form" novalidate>
        {% csrf_token %}

        <div class="grid">
          <div class="field">
            <label for="national_id">السجل المدني</label>
            <input
              id="national_id"
              name="national_id"
              inputmode="numeric"
              autocomplete="off"
              placeholder="مثال: 10xxxxxxxx"
              required
            >
          </div>

          <div class="field">
            <label for="last4">آخر 4 أرقام من الجوال</label>
            <input
              id="last4"
              name="last4"
              inputmode="numeric"
              maxlength="4"
              autocomplete="off"
              placeholder="مثال: 1234"
              required
            >
          </div>
        </div>

        <button class="btn auth-btn" type="submit">دخول</button>

        <div class="tip">
          <span class="ic">ℹ️</span>
          <span>
            إذا ظهرت رسالة <b>يوجد اختبار جارٍ</b> فهذا يعني أن هناك جلسة أخرى مفتوحة لنفس السجل.
            تواصل مع الإدارة لإعادة فتح المحاولة عند الحاجة.
          </span>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block base_css_extra %}
  .wrap{max-width:1180px;margin:0 auto;padding:18px 16px 40px;}
  .auth-wrap{
    min-height: calc(100vh - 64px);
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 18px 16px 40px;
  }
  .auth-card{
    width: min(560px, 100%);
    border-radius: 26px;
    border:1px solid rgba(231,238,246,.95);
    box-shadow: 0 22px 60px rgba(2,44,34,.10);
    background:
      radial-gradient(900px 240px at 15% 0%, rgba(16,185,129,.14), transparent 60%),
      radial-gradient(900px 240px at 85% 0%, rgba(14,165,164,.12), transparent 60%),
      rgba(255,255,255,.82);
    backdrop-filter: blur(10px);
    overflow:hidden;
  }

  .auth-head{
    padding: 16px 16px 10px;
    border-bottom:1px solid rgba(231,238,246,.95);
    background: rgba(255,255,255,.55);
  }

  .auth-hero{
    display:flex;
    gap:12px;
    align-items:flex-start;
  }

  .auth-hero-text{flex:1; min-width: 0;}

  .auth-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    justify-content:flex-end;
    align-items:center;
    margin-inline-start: auto;
  }

  .btn-mini{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:7px 10px;
    border-radius:999px;
    font-weight:1000;
    font-size:12px;
    border:1px solid rgba(231,238,246,.95);
    background: rgba(255,255,255,.78);
    color: #0f172a;
    text-decoration:none;
    box-shadow: 0 10px 20px rgba(2,44,34,.06);
  }
  .btn-mini:hover{transform: translateY(-1px);}

  .btn-mini.ghost{
    background: rgba(2,132,199,.06);
    border-color: rgba(2,132,199,.14);
  }
  .btn-mini.danger{
    background: rgba(239,68,68,.08);
    border-color: rgba(239,68,68,.18);
    color: #991b1b;
  }

  .auth-ico{
    width:46px;height:46px;border-radius:18px;
    display:flex;align-items:center;justify-content:center;
    background: linear-gradient(135deg, rgba(14,165,164,.95), rgba(16,185,129,.95));
    box-shadow: 0 16px 30px rgba(16,185,129,.18);
    color:#fff;font-weight:1000;font-size:18px;
    flex:0 0 auto;
  }
  .auth-title{margin:0;font-size:18px;font-weight:1000;color:var(--ink)}
  .auth-sub{margin:6px 0 0;color:var(--mut);font-weight:800;line-height:1.9;font-size:13px}

  .auth-body{padding: 14px 16px 16px}
  .auth-form{margin:0}
  .grid{display:grid;grid-template-columns: 1fr 1fr; gap:10px}
  @media (max-width: 640px){
    .grid{grid-template-columns:1fr;}
    .auth-actions{justify-content:flex-start; margin-top:10px;}
    .auth-hero{flex-wrap:wrap;}
  }

  .field label{
    display:block;
    font-weight:1000;
    font-size:12.8px;
    margin-bottom:6px;
    color:var(--ink);
  }

  .auth-btn{
    width:100%;
    margin-top:12px;
    padding:12px 14px;
    border-radius:18px;
    font-size:14px;
    font-weight:1000;
  }

  .tip{
    margin-top:12px;
    display:flex;
    gap:10px;
    align-items:flex-start;
    padding:10px 12px;
    border-radius:18px;
    background: rgba(2,132,199,.06);
    border:1px solid rgba(2,132,199,.14);
    color: #0f172a;
    font-weight:850;
    line-height:1.9;
    font-size:12.6px;
  }
  .tip .ic{
    width:28px;height:28px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    background:#fff;border:1px solid rgba(2,132,199,.18);
    flex:0 0 auto;
  }
{% endblock %}

{% block extra_js %}
<script>
(function(){
  const nat = document.getElementById("national_id");
  const last4 = document.getElementById("last4");
  if (!nat || !last4) return;

  function digitsOnly(el, maxLen){
    el.addEventListener("input", () => {
      let v = (el.value || "").replace(/\D+/g, "");
      if (maxLen) v = v.slice(0, maxLen);
      el.value = v;
    });
  }

  digitsOnly(nat, 0);
  digitsOnly(last4, 4);

  setTimeout(() => nat.focus(), 80);
})();
</script>
{% endblock %}
