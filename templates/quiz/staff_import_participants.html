{% extends "quiz/base.html" %}
{% comment %}
templates/quiz/staff_import_participants.html
{% endcomment %}
{% block title %}Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†{% endblock %}

{% block extra_head %}
<style>
  .shell{max-width:1100px;margin:0 auto;}
  .head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
  .sub{margin-top:6px;line-height:1.95}

  .tabs{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
  .tab{
    display:inline-flex;align-items:center;gap:8px;
    padding:9px 12px;border-radius:999px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.92);
    color:var(--ink);text-decoration:none;font-weight:900;font-size:12px;
    box-shadow: 0 8px 18px rgba(2,44,34,.06);
    transition: transform .12s ease, background .12s ease;
  }
  .tab:hover{transform: translateY(-1px); background:rgba(14,165,164,.04)}
  .tab.primary{
    background: linear-gradient(135deg, rgba(14,165,164,.95), rgba(16,185,129,.95));
    color:#fff;border-color: rgba(14,165,164,.25);
  }

  .glass{
    background:rgba(255,255,255,.78);
    border:1px solid rgba(231,238,246,.95);
    border-radius:22px;
    box-shadow: var(--shadow2);
  }
  .pad{padding:14px}
  .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:12px;align-items:start;}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

  .lbl{display:block;margin-bottom:6px;font-weight:900;color:var(--mut);font-size:12.2px;}
  .hint{color:var(--mut);font-size:12.3px;line-height:1.9}

  .note{
    padding:10px 12px;border-radius:16px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.92);
    box-shadow: 0 10px 22px rgba(2,44,34,.05);
    font-weight:900;font-size:12.5px;line-height:1.9;
  }

  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:5px 10px;border-radius:999px;
    font-size:11.5px;font-weight:900;
    border:1px solid rgba(231,238,246,.95);
    background:#fff;color:var(--mut)
  }

  .row{display:grid;grid-template-columns: 1fr 1fr;gap:10px;}
  @media (max-width: 720px){ .row{grid-template-columns:1fr;} }

  input[type="text"], input[type="file"]{
    width:100%;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(231,238,246,.95);
    background:#fff;
    font-weight:800;
    outline:none;
  }
  input[type="text"]:focus, input[type="file"]:focus{
    border-color: rgba(14,165,164,.45);
    box-shadow: 0 0 0 4px rgba(14,165,164,.08);
  }

  .check{
    display:flex;gap:10px;align-items:flex-start;
    font-weight:900;line-height:1.9;margin-top:10px;
    padding:8px 10px;border-radius:14px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.86);
  }
  .check input{margin-top:4px}

  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn.soft{background:#fff;color:var(--ink);border:1px solid rgba(231,238,246,.95);box-shadow:none;}
  .btn.soft:hover{background:rgba(14,165,164,.04);}

  /* messages inline (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ùˆ ØªØ­Ø¨ ØªØ¸Ù‡Ø±Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© Ø£ÙŠØ¶Ù‹Ø§) */
  .msgs{display:grid;gap:8px;margin-bottom:12px}
  .msg{
    display:flex;gap:10px;align-items:flex-start;
    padding:10px 12px;border-radius:16px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.92);
    box-shadow: 0 10px 22px rgba(2,44,34,.05);
    font-weight:900;font-size:12.7px;line-height:1.9;
  }
  .msg .ic{
    width:28px;height:28px;border-radius:10px;
    display:flex;align-items:center;justify-content:center;
    font-size:14px;flex:0 0 auto;
    background:rgba(14,165,164,.10);
    border:1px solid rgba(14,165,164,.18);
  }

  .kpi{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap:10px;
    margin-top:12px;
  }
  @media (max-width: 720px){ .kpi{grid-template-columns:1fr;} }
  .k{
    padding:10px 12px;border-radius:18px;
    border:1px solid rgba(231,238,246,.95);
    background:rgba(255,255,255,.92);
  }
  .k .t{font-size:12px;color:var(--mut);font-weight:900}
  .k .v{margin-top:4px;font-size:18px;font-weight:1000;color:var(--ink)}
  code{background:rgba(15,23,42,.06);padding:2px 6px;border-radius:10px;font-weight:900}
</style>
{% endblock %}

{% block content %}
<div class="shell">

  <div class="card">
    <div class="head">
      <div>
        <h2 style="margin:0">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†</h2>
        <div class="mut sub">
          ÙŠØ³ØªÙˆØ±Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø´Ø­ Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ <b>Participant</b>:
          <span class="pill">national_id</span>
          <span class="pill">full_name</span>
          <span class="pill">phone_last4</span>
          <span class="pill">domain</span>
        </div>
      </div>

      <div class="tabs">
        <a class="tab" href="{% url 'quiz:staff_manage' %}">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
        <a class="tab" href="{% url 'quiz:staff_import_questions' %}">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</a>
        <a class="tab primary" href="{% url 'quiz:staff_import_participants' %}">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†</a>
      </div>
    </div>

    {# âœ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø±Ø³Ø§Ø¦Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© - Ù„Ùˆ Ù…Ø§ ØªØ¨ÙŠÙ‡Ø§ Ø§Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„ÙˆÙƒ Ù„Ø£Ù† Ø¹Ù†Ø¯Ùƒ Toast ÙÙŠ base.html #}
    {% if messages %}
      <div class="msgs">
        {% for message in messages %}
          <div class="msg">
            <div class="ic">âœ“</div>
            <div>{{ message }}</div>
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="glass pad">
      <div class="grid">

        <!-- ================= Left: Form ================= -->
        <div>
          <div class="note">
            âœ… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Excel (Ù„Ø§Ø²Ù… Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØªÙ…Ø§Ù…Ù‹Ø§):
            <div class="mut" style="margin-top:6px">
              <code>national_id</code>, <code>full_name</code>, <code>phone_last4</code>, <code>domain</code><br>
              domain ÙŠÙ‚Ø¨Ù„ Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙˆØ³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ù‡ Ø¯Ø§Ø®Ù„ÙŠÙ‹Ø§ Ø¥Ù„Ù‰:
              <b>deputy</b> / <b>counselor</b> / <b>activity</b>
            </div>
          </div>

          <form method="post" enctype="multipart/form-data" style="margin-top:12px" class="glass">
            {% csrf_token %}
            <div class="pad">

              <label class="lbl">Ù…Ù„Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ† (Excel .xlsx)</label>
              <input type="file" name="file" accept=".xlsx" required>

              <div style="height:10px"></div>

              <div class="row">
                <div>
                  <label class="lbl">Ø§Ø³Ù… Ø§Ù„Ø´ÙŠØª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù</label>
                  <input type="text" name="sheet_name" value="participants" placeholder="participants">
                  <div class="hint" style="margin-top:6px">
                    Ø¥Ø°Ø§ ØªØ±ÙƒØªÙ‡ ÙØ§Ø±ØºÙ‹Ø§ØŒ Ø³ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙˆÙ„ Sheet (Ø­Ø³Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ù€ view Ù„Ø¯ÙŠÙƒ).
                  </div>
                </div>

                <div>
                  <label class="lbl">Ø£Ù…Ø«Ù„Ø© domain</label>
                  <div class="note" style="font-weight:900">
                    ÙˆÙƒÙŠÙ„ / deputy<br>
                    Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ / guidance / counselor<br>
                    Ø±Ø§Ø¦Ø¯ Ù†Ø´Ø§Ø· / activity
                  </div>
                </div>
              </div>

              <label class="check">
                <input type="checkbox" name="replace" value="1">
                <span>
                  <b>Replace</b>: ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¬Ù…ÙŠØ¹ <b>ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ÙŠÙ†</b> Ø«Ù… ÙŠÙØ¹Ù‘Ù„ ÙÙ‚Ø· Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù„Ù.
                </span>
              </label>

              <label class="check">
                <input type="checkbox" name="reset_taken" value="1">
                <span>
                  ØªØµÙÙŠØ± <b>has_taken_exam</b> Ù„Ù„Ù…Ø³ØªÙˆØ±ÙØ¯ÙŠÙ† (Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù‡Ù…).
                </span>
              </label>

              <div class="actions">
                <button class="btn" type="submit">Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
                <a class="btn soft" href="{% url 'quiz:staff_manage' %}">Ø±Ø¬ÙˆØ¹</a>
              </div>

              <div class="hint" style="margin-top:10px">
                ÙŠÙ‚Ø¨Ù„ domain Ù…Ø«Ù„: (ÙˆÙƒÙŠÙ„/Ù…ÙˆØ¬Ù‡ Ø·Ù„Ø§Ø¨ÙŠ/Ø±Ø§Ø¦Ø¯ Ù†Ø´Ø§Ø·) Ø£Ùˆ (deputy/counselor/activity) Ø£Ùˆ (guidance â†’ counselor).
              </div>

            </div>
          </form>

          {# âœ… Ù…Ù„Ø®Øµ Ø£Ø±Ù‚Ø§Ù… Ù„Ùˆ Ø§Ù„Ù€ view ÙŠØ±Ø³Ù„Ù‡Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) #}
          {% if imported_count or updated_count or skipped_count %}
            <div class="kpi">
              <div class="k">
                <div class="t">Imported</div>
                <div class="v">{{ imported_count|default:0 }}</div>
              </div>
              <div class="k">
                <div class="t">Updated</div>
                <div class="v">{{ updated_count|default:0 }}</div>
              </div>
              <div class="k">
                <div class="t">Skipped</div>
                <div class="v">{{ skipped_count|default:0 }}</div>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- ================= Right: Rules ================= -->
        <div>
          <div class="note">
            ğŸ”’ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚
            <div class="mut" style="margin-top:6px;line-height:1.9">
              â€¢ <b>phone_last4</b> Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø§Ø²Ù… 4 Ø£Ø±Ù‚Ø§Ù…<br>
              â€¢ <b>domain</b> Ù„Ø§Ø²Ù… ÙŠØªØ­ÙˆÙ„ Ù„Ø£Ø­Ø¯ Ø§Ù„Ø«Ù„Ø§Ø«Ø© (deputy / counselor / activity)<br>
              â€¢ Ø£ÙŠ ØµÙ ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ ÙŠÙØ­Ø³Ø¨ Ø¶Ù…Ù† <b>skipped</b>
            </div>
          </div>

          <div class="glass" style="padding:12px;margin-top:12px">
            <div class="pill">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©</div>
            <div class="mut" style="margin-top:6px;line-height:1.9">
              â€¢ ØªØ£ÙƒØ¯ Ø£Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù‡ÙŠ Ù†ÙØ³Ù‡Ø§ ØªÙ…Ø§Ù…Ù‹Ø§ (lowercase).<br>
              â€¢ Ù„Ùˆ ÙÙŠÙ‡ Ù…Ø³Ø§ÙØ§Øª ÙÙŠ Ø¨Ø¯Ø§ÙŠØ©/Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ØŒ Ø§Ù„Ø£ÙØ¶Ù„ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù„Ù Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹.<br>
              â€¢ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠÙÙØ¶Ù‘Ù„ ÙƒÙ†Øµ Ø¯Ø§Ø®Ù„ Excel Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù„Ù…ÙŠ.
            </div>
          </div>

          <div class="glass" style="padding:12px;margin-top:12px">
            <div class="pill">Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©</div>
            <div class="mut" style="margin-top:6px;line-height:1.9">
              <code>national_id</code><br>
              <code>full_name</code><br>
              <code>phone_last4</code><br>
              <code>domain</code>
            </div>
          </div>

        </div>

      </div>
    </div>

  </div>
</div>
{% endblock %}
